<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--    <link rel="stylesheet" href="boxicons/css/boxicons.min.css">-->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel='stylesheet'>
    <link rel="stylesheet" href="/assets/web-toast/src/webToast.css">
    <link rel="stylesheet" href="/assets/css/login.css">


    <title>Login & Registration</title>
</head>

<body>
<div class="wrapper">


    <nav class="nav">
        <div class="col-xl-2 col-lg-2 col-md-1">
            <div class="logo">
                <img src="/assets/img/logo/logo.png" alt="">
            </div>
        </div>

        <div class="nav-button">

            <button class="btn white-btn" id="login-box-link">Sign In</button>

            <button class="btn" id="signup-box-link">Sign Up</button>
        </div>
    </nav>
    <!----------------------------- Form box ----------------------------------->
    <div class="form-box">

        <!------------------- login form -------------------------->
        <form class="login-container" id="login">
            <div class="top">
<!--                <span>Don't have an account?Sign Up</span>-->
                <header>Login</header>
            </div>
            <div class="input-box">
                <input type="text" class="input-field" placeholder="Username" id="tbUsername">
                <i class="bx bx-user"></i>
            </div>
            <div class="input-box">
                <input type="password" class="input-field" placeholder="Password" id="tbPassword">
                <i class="bx bx-lock-alt"></i>
            </div>
            <div class="input-box">
                <button type="button" class="submit" id="btnLogin">Sign In</button>
            </div>
        </form>
        <form class="register-container" id="register">
            <div class="top">
<!--                <span>Have an account? Login</span>-->
                <header>Sign Up</header>
            </div>

            <div class="input-box">
                <input type="text" class="input-field" placeholder="Username" id="reUserName">
                <i class="bx bx-user"></i>
            </div>
            <div class="input-box">
                <input type="text" class="input-field" placeholder="Enter your phone" id="phone">
                <i class="bx bx-phone"></i>
            </div>
            <div class="input-box">
                <input type="password" class="input-field" placeholder="Password" id="rePassword">
                <i class="bx bx-lock-alt"></i>
            </div>
            <div class="input-box">
                <input type="password" class="input-field" placeholder="Re-Password" id="rePasswordReplay">
                <i class="bx bx-lock-alt"></i>
            </div>
            <div class="input-box">
                <button type="button" class="submit" id="btnRegister">Register</button>
            </div>
        </form>
    </div>
</div>
<script src="/assets/jquery/jquery-3.5.1.min.js"></script>
<script src="/assets/web-toast/src/webToast.js"></script>
<script src="/assets/js/login.js"></script>

<script>
    const btnRegister = $('#btnRegister');
    btnRegister.on('click', () => {
        const username = $('#reUserName').val();
        const password = $('#rePassword').val();
        const phone = $('#phone').val();
        const passwordReplay = $('#rePasswordReplay').val();
        const roleId = 2;
        const obj = {
            username,
            password,
            phone,
            roleId
        }
        if(username.length == 0){
            webToast.Danger({
                status: 'vui lòng nhập username',
                message: '',
                delay: 2000,
                align: 'topright'
            });
        }
        if(isNaN(parseInt(phone))){
            webToast.Danger({
                status: 'vui lòng nhập số điện thoại là số',
                message: '',
                delay: 2000,
                align: 'topright'
            });
        }
        if(password !== passwordReplay){
            webToast.Danger({
                status: 'mật khẩu không trùng khớp',
                message: '',
                delay: 2000,
                align: 'topright'
            });
        }
        if(password == passwordReplay && !isNaN(parseInt(phone)) && username.length > 0) {
            $.ajax({
                headers: {
                    'content-type': 'application/json'
                },
                type: 'POST',
                url: 'http://localhost:9001/api/auth/register',
                data: JSON.stringify(obj)
            })
                .done((data) => {
                    webToast.Success({
                        status: 'Đăng kí thành công',
                        message: '',
                        delay: 2000,
                        align: 'topright'
                    });
                })
                .fail((error) => {
                    console.log(error);
                    // webToast.Danger({
                    //     status: 'Lỗi đăng kí tài khoản. Vui lòng nhập đầy đủ thông tin',
                    //     message: '',
                    //     delay: 2000,
                    //     align: 'topright'
                    // });
                })
        }
    })


</script>

<script>
    const btnLogin = $('#btnLogin');

    btnLogin.on('click', () => {
        const username = $('#tbUsername').val();
        const password = $('#tbPassword').val();

        const obj = {
            username,
            password
        }

        $.ajax({
            headers: {
                'content-type': 'application/json'
            },
            type: 'POST',
            url: 'http://localhost:9001/api/auth/login',
            data: JSON.stringify(obj)
        })
            .done((data) => {
                console.log(data)
                const roleUser = data.roles[0].authority;
                console.log("Login success")
                if(roleUser == "ADMIN"){
                    location.href = '/customers'
                }else {

                    location.href = '/home'

                }


            })
            .fail((error) => {
                console.log(error);
                webToast.Danger({
                    status: 'Vui lòng nhập đúng tài khoản để đăng nhập',
                    message: '',
                    delay: 2000,
                    align: 'topright'
                });
            })
    })


</script>


</body>

</html>